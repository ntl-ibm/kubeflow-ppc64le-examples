{% from "column_tools.jinja" import build_form_inputs %} 
{% from "column_tools.jinja" import render_cat_feature %} 
{% from "column_tools.jinja" import render_explain_anchors %}
<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8" />
    <title>View/Edit account {{ client_info_values['CLIENT_ID'] }} </title>
    <link rel="shortcut icon" href="{{- url_for('static', filename='favicon.ico') -}}" />
    <link rel="stylesheet" href="{{- url_for('static', filename='css/style.css') -}}" />
    <script src="{{- url_for('static', filename='js/handleFormSubmit.js') -}}"></script>
  </head>

  <body>
    {% include 'nav_bar.jinja' %}
    <form id="account_info" onsubmit="return false">
      <div id="pageloader">
        <img src="{{- url_for('static', filename='bee.png') -}}" id="spinner"/> 
      </div>

      <fieldset id="account_header"">
        <legend>Account</legend>
        <label for="account-id"> Account Id</label>
        <input id="account-id" value="{{ client_info_values['CLIENT_ID'] }}" type="number" readonly/> 
      </fieldset>

      <fieldset id="account_details" disabled="disabled">
        <legend>Account Details</legend>
       
          {{ build_form_inputs(schema, client_info_values) }}
      
          {% set risk_levels = schema.label_columns['Risk'] + ["Unknown"] %}
          {{ render_cat_feature('Risk', 
                                risk_levels, 
                                client_info_values['Risk'] if client_info_values['Risk'] 
                                                           else "Unknown") 
          }}

      </fieldset>

      <fieldset id="predicted_risk_assessment">
        <legend>Predicted Risk Assessment</legend>
        
        <label for="PredictedRisk">Assessment</label>
        <input id="PredictedRisk" value="{{client_info_values['PredictedRisk']}}" readonly />

        {% if client_info_values['ExplainRisk'] %}
           <label for="ExplainRisk">Explaination</label>
              {%set explaination = render_explain_anchors(client_info_values['ExplainRisk'])%}
                <textarea id="ExplainRisk" rows="5" cols="50" readonly>
                  {{- explaination -}}
                </textarea>
        {% endif %}
      </fieldset>
     <div id="edit_buttons" class="centered_button">
      <button id="edit">Edit</button>
     </div>
     <div id="update_buttons" class="centered_button">
        <button id="submit">Update</button>
        <button id="reset" onclick="this.form.reset();">Reset</button>
     </div>
    </form>

    {% include 'footer.jinja' %}
  </body>

  <script>
    document.getElementById("edit_buttons").style.display = 'block'
    document.getElementById("update_buttons").style.display = 'none'
    const pr = document.getElementById("PredictedRisk")  
    if (pr.value == 'Risk') {
      pr.classList.add('risk')
    } else if (pr.value == 'No Risk') {
      pr.classList.add('norisk')
    }
  </script>

  <script>
    const editButton = document.getElementById("edit")
    editButton.addEventListener("click", (event) => {
      const account_details = document.getElementById("account_details")
      account_details.disabled = false;
      const predicted_risk_assessment = document.getElementById("predicted_risk_assessment")
      predicted_risk_assessment.style.display = "none"
      event.target.disabled = true;
      document.getElementById("edit_buttons").style.display = "none";
      document.getElementById("update_buttons").style.display = 'block';
    })
  </script>

   <script>
    const submitButton = document.getElementById("submit")
    submitButton.addEventListener("click", (event) => {
      const form = document.getElementById("account_info");
      const formData = new FormData(form);
      event.target.disabled = true;
      document.getElementById('account_details').disabled = "disabled"
      form.classList.toggle('fade-out')
      pageloader = document.getElementById('pageloader')
      pageloader.style.display = "block";

      sendFormDataAsJson("{{- url_for('Accounts.update_account_info', account_id=client_info_values['CLIENT_ID']) -}}", "PUT", formData);
    });
  </script>

</html>
